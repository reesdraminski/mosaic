<html>
    <head>
        <title>Learning JavaScript with Mosaic</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" href="codemirror/codemirror.css">
        <link rel="stylesheet" href="style.css">
    </head>

    <body>
        <div class="nav">
            <a href="javascript:void(0)" onclick="openModal('lessons')">Getting Started</a>
            <a href="javascript:void(0)" onclick="openModal('examples')">Examples</a>
            <a href="javascript:void(0)" onclick="openModal('help')">Help</a>
            <a href="javascript:void(0)" onclick="openModal('about')">About</a>

            <button disabled id="stopRunning" onclick="stopRunning()" style="float: right">Stop Running</button>
            <button id="runCode" onclick="runCode()" style="float: right">Run Code</button>
        </div>

        <div class="panel-container">
            <!-- CodeMirrorEditor -->
            <div class="panel-left" style="width: 50%">
                <div id="editor"></div>
            </div>

            <div class="splitter"></div>

            <!-- HTML Preview -->
            <div class="panel-right" style="height: 100%; overflow: scroll">
                <div id="preview">
                    <table class="mb-2" id="mosaic"></table>
                
                    <b>Console (<a href="javascript:clearConsole();">Clear</a>):</b>
                    <div id="console" readonly></div>
                </div>
            </div>
        </div>

        <div id="myModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <span class="close" onclick="closeModal()">&times;</span>
                    <h2 id="modalTitle"></h2><hr>
                </div>

                <div class="modal-body">
                    <div class="modalContent" id="lessons" style="display: none;"></div>
                    <div class="modalContent" id="examples" style="display: none;"></div>
                    <div class="modalContent" id="help" style="display: none;"></div>
                    <div class="modalContent" id="about" style="display: none;"></div>
                </div>

                <div class="modal-footer">
                    <ul id="learningPath" style="display: none;">
                        <li class="active">
                            <a href="#variables">1</a>
                        </li>
                        <li>
                            <a href="#calling_functions">2</a>
                        </li>
                        <li>
                            <a href="#conditionals">3</a>
                        </li>
                        <li>
                            <a href="#loops">4</a>
                        </li>
                        <li>
                            <a href="#creating_functions">5</a>
                        </li>
                    </ul>

                    <p style="text-align: right">
                        <button class="btn" onclick="closeModal()">Close</button>
                    </p>
                </div>
            </div>
        </div>

        <!-- CodeMirror JavaScript -->
        <script src="codemirror/codemirror.js"></script>
        <script src="codemirror/formatting.js"></script>
        <script src="codemirror/addon/edit/closebrackets.js"></script>
        <script src="codemirror/addon/selection/active-line.js"></script>
        <script src="codemirror/addon/runmode/runmode.js"></script>
        <script src="codemirror/mode/javascript/javascript.js"></script>

        <!-- Splitter Panel JavaScript -->
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
        <script src="js/jquery-resizable.min.js"></script>

        <script src="js/api.js"></script>
        <script src="js/editor.js"></script>
        
        <script>
            const LESSONS = [
                {
                    name: "Variables",
                    blocks: [
                        {
                            type: "h1",
                            content: "Variables"
                        },
                        {
                            type: "p",
                            content: "Think of a variable as a labeled container that can hold different kinds of things. Instead of holding food or clothes, variables hold data. Just as there are different types of containers, there are different types of variables. You <i>create</i> a variable, and <i>assign</i> it a value."
                        },
                        {
                            type: "p",
                            content: "In JavaScript, you can have a variable that changes value (<i>mutable</i>) or one that does not change value (<i>immutable</i>). For mutable variables, you use <b>let</b> and for immutable variables, you use <b>const</b>."
                        },
                        {
                            type: "code",
                            content: 'const myName = "Rees";\n\nlet myAge = 19;'
                        },
                        {
                            type: "p",
                            content: "A more advanced type of JavaScript variables are something called objects. An object is a copy of a class, where a class is a collection of variables, and something else that you will learn later called functions. When you create a copy, or instance, of a class, you can use that variable to access the variables and functions of that object."
                        },
                        {
                            type: "code",
                            content: "const moz = new Mosaic(5, 5);"
                        }
                    ]
                },
                {
                    name: "Calling Functions",
                    blocks: [
                        {
                            type: "h1",
                            content: "Calling Functions"
                        },
                        {
                            type: "p",
                            content: "Functions are lines of code that have been grouped together and can be called upon by a name. Functions can be attached to an object, or just for general use. When you call a function, you sometimes pass parameters to the function. There are pre-defined inputs that the function expects, you give them by putting them in parenthesis after the function name."
                        }
                    ]
                },
                {
                    name: "Conditionals",
                    blocks: [
                        {
                            type: "h1",
                            content: "Conditionals"
                        },
                       { 
                            type: "p",
                            content: "Conditionals are statement that check conditions, which can be either true or false, and then do something depending on that state. Sometimes they are referred to as If-Then, Else-Then statements. If you want to check multiple conditions after each other, you can use else if. If, else if, and else statements are evaluated in sequential order, so you must be careful. If you have an else or an else if, you must have an if before it, but if you have an if, you do not need anything additional."
                        }
                    ]
                },
                {
                    name: "Loops",
                    blocks: [
                        {
                            type: "h1",
                            content: "Loops"
                        },
                        {
                            type: "p",
                            content: "The loop header has the 1. variable initialization, 2. the condition, and 3. the variable mutation."
                        },
                        {
                            type: "ol",
                            blocks: [
                                {
                                    type: "li",
                                    content: "Variable initialization only happens at the first iteration (a.k.a run through) of the loop. It sets up our counter."
                                },
                                {
                                    type: "li",
                                    content: "The condition is checked before every iteration to check if the loop should run or not."
                                },
                                {
                                    type: "li",
                                    content: "The variable is then mutated, you can do any math operation you want to on the variable."
                                }
                            ]
                        },
                        {
                            type: "code",
                            content: "for (let i = 0; i < moz.width; i++)"
                        },
                        {
                            type: "p",
                            content: "You can also put loops inside of other loops, this is called nesting. The inner loops finish first, then goes outwards."
                        }
                    ]
                },
                {
                    name: "Creating Functions",
                    blocks: [
                        {
                            type: "p",
                            content: "As previously written, functions are lines of code that have been grouped together and can be called upon by a name. These functions can take inputs called parameters, and can return outputs."
                        },
                        {
                            type: "p",
                            content: "You can have two functions with the same name, as long as they have different parameters, or orders of parameters. This is called function overloading."
                        },
                        {
                            type: "code",
                            content: 'const moz = new Mosaic(5, 5);\n\nfunction drawLine() {\n\tfor (let x = 0; x < moz.width; x++) {\n\t\tmoz.setTileColor(x, 0, "blue");\n\t}\n}'
                        }
                    ]
                }
            ];

            const DOCS = [

            ];

            // Get the modal
            

            // render all of the lessons
            LESSONS.forEach(lesson => {
                // create a div for each lesson
                const lessonContainer = document.createElement("div");
                lessonContainer.id = lesson.name.split(" ").join("_").toLowerCase();
                lessonContainer.className = "lesson";

                // add the lesson to the lessons div
                document.getElementById("lessons").appendChild(lessonContainer);

                // render the blocks for that lesson
                renderBlocks(lesson.blocks, lessonContainer);
            });

            function openModal(content) {
                const modal = document.getElementById("myModal");

                modal.style.display = "block";

                // hide all modal content possibilites
                for (const el of document.getElementsByClassName("modalContent"))
                    el.style.display = "none";
                document.getElementById("learningPath").style.display = "none";

                let title;
                if (content == "lessons")  {
                    title = "Learn JavaScript";

                    document.getElementById("lessons").style.display = "";
                    // document.getElementById("learningPath").style.display = "";
                }
                else if (content == "examples") {
                    title = "Example Scripts";

                    document.getElementById("examples").style.display = "";
                }
                else if (content == "help") {
                    title = "Mosaic Help"
                }
                else if (content == "about") {
                    title = "About Mosaic";
                }

                document.getElementById("modalTitle").innerText = title;
            }

            function closeModal() { 
                const modal = document.getElementById("myModal");
                modal.style.display = "none" 
            }

            // when the user clicks anywhere outside of the modal, close it
            window.onclick = e => {
                const modal = document.getElementById("myModal");

                // if clicking outside of modal
                if (e.target == modal) 
                    modal.style.display = "none";
            }

            // document.querySelectorAll("#learningPath li a").forEach(el => el.onclick = selectLesson);

            // let currentLesson;
            // function selectLesson(lessonNum) {
            //     currentLesson = lessonNum;
            // }

            // selectLesson(0);

            // const lessonDivs = document.getElementsByClassName("lesson");

            // for (const div of lessonDivs) 
            //     div.style.display = "none";
            
            // lessonDivs[currentLesson].classList.toggle("active");

            function renderBlocks(blocks, parent) {
                for (const block of blocks) {
                    // if the block doesn't have blocks in it
                    if (block.content) {
                        let el;

                        // treat code as special block
                        if (block.type == "code") {
                            // create code block as pre to keep whitespace
                            el = document.createElement("pre");

                            // add code mirror className so syntax highlighting works
                            el.className = "cm-s-default";
                        
                            // run CodeMirror syntax highlighting on the code
                            CodeMirror.runMode(block.content, { name: "javascript" }, el);
                        }
                        // for any other element
                        else {
                            el = document.createElement(block.type);
                            el.innerHTML = block.content;
                        }

                        // add the new element to the parent
                        parent.appendChild(el);
                    }
                    // if the block has other blocks in it
                    else {
                        // create the container element that will contain the other blocks
                        const container = document.createElement(block.type);

                        // add the new container to the parent element
                        parent.appendChild(container);

                        // render the blocks inside the container
                        renderBlocks(block.blocks, container);
                    }
                }
            }
        </script>
    </body>
</html>